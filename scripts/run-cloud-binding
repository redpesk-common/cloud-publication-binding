#!/bin/bash -x
# Redis replication binding

WD="$HOME/Documents/Dev/repos/vrubiolo/rp-service-cloud/build"
GDB_CMD="$HOME/Documents/Dev/repos/vrubiolo/rp-service-cloud/scripts/gdb-init"
REDIS="$HOME/Documents/Dev/repos/iotbzh/rp-service-hiredis/build"

if [[ "$1" == "debug" ]]; then
    GDB="gdb -x $GDB_CMD --args"
    #export AFB_DEBUG_BREAK=main-entry
fi

cd $WD
# XXX: process name in getBinderName() truncates it to 17 chars!
$GDB afb-binder --name redis-replica --port=5678 --workdir=$WD \
--binding=package/lib/redis-replication.so \
--roothttp=package/htdocs --tracereq=common -vvv \
--ws-client=tcp:localhost:1212/redis-from-cloud \
--ws-client=unix:/tmp/redis \
--monitoring
